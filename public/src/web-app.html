<polymer2>
    <link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
    <link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
    <link rel="import" href="../bower_components/polymer/lib/utils/import-href.html">
    <link rel="import" href="../bower_components/neon-animation/web-animations.html">
    <link rel="import" href="../bower_components/shadycss/apply-shim.html">
    <link rel="import" href="../bower_components/polymer/lib/utils/render-status.html">
    <!-- paper-material deprecated -->
    <link rel="import" href="../bower_components/paper-styles/shadow.html">
</polymer2>
<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href='./icon-imports.html'>
<link rel="import" href="./score-board.html">

<imports>       
        <link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href='/bower_components/polymer/polymer-element.html'>
    <link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="/bower_components/neon-animation/neon-animated-pages.html">
    <link rel="import" href="/bower_components/neon-animation/neon-animation-runner-behavior.html">
    <link rel="import" href="/bower_components/neon-animation/neon-animations.html">
    <link rel="import" href="/bower_components/neon-animation/neon-shared-element-animatable-behavior.html">
    <link rel="import" href='./icon-imports.html'>
    <link rel="import" href="/bower_components/paper-toast/paper-toast.html">
    <link rel="import" href="/bower_components/paper-button/paper-button.html">
</imports>

<dom-module id="web-app">
    <template>
        <style>
            [wrapper] {
                margin-top: 150px;
                width: 100%;
               @apply --layout-center;
               @apply --layout-vertical;
               @apply --layout-center-justified;
            }
            score-board:hover{
                opacity: 0.9; 
                cursor: pointer ;
            }
            paper-toast {
                @apply --justify-text;
                font-size: 20px;
                margin-bottom: 5vh;
                border-radius: 3px;
                max-width: 65vw;
            }
        </style>
        <paper-toast id="toast"></paper-toast>
        <paper-toast id="toastPersist" duration="0">
            <paper-icon-button icon='close' on-click="_closeToastPersist"></paper-icon-button>
        </paper-toast>
        <div wrapper>
            <score-board on-click='_selectScoreBoard' id='scoreboard_0' selected ='true'> </score-board>
            <!-- <score-board on-click='_selectScoreBoard' id='scoreboard_1' > </score-board> -->
        </div>
    </template>
    <script>
        class WebApp extends Polymer.Element {
            static get is() {
                return 'web-app';
            }
            static get properties() {
                return {
                    currentPlayer:{type:Number,value:0},
                }
            }
            constructor() {
                super();
            }
            async openToast (e) {
                let toast = this.$.toast ; 
                if(e.detail.persist) 
                    toast = this.$.toastPersist  ;
                if(toast.text === e.detail.msg && toast.opened)
                    return ;

                if(toast.opened)
                    toast.close() ; 
                toast.text = e.detail.msg;
                toast.open();
            }
            _closeToastPersist() {
                this.$.toastPersist.toggle() ;     
            }
            _selectScoreBoard(e) {
                this.shadowRoot.querySelector('#'+e.currentTarget.id).selected = true ; 
                this.shadowRoot.querySelector('#scoreboard_'+this.currentPlayer).selected = false ; 
                this.currentPlayer = e.currentTarget.id.split('_')[1] ; 
                this.shadowRoot.querySelector('#scoreboard_'+this.currentPlayer).selected = true ; 
            }
            _goToNextPlayer() {
                Polymer.RenderStatus.afterNextRender(this, function() {
                    let arr = Polymer.dom(this.root).querySelectorAll('score-board');
                    if(arr.length === 1)
                        return ;
                    this.shadowRoot.querySelector('#scoreboard_'+this.currentPlayer).selected = false ; 
                    this.currentPlayer ++ ; 
                    this.currentPlayer %= arr.length ;
                    this.shadowRoot.querySelector('#scoreboard_'+this.currentPlayer).selected = true ; 
                });
            }
            ready() {
                super.ready();
                this.addEventListener('rolls-computed', e => this._goToNextPlayer(e));
                this.addEventListener('toast', e => this.openToast(e));
            }
        }
        customElements.define('web-app', WebApp);
    </script>
</dom-module>